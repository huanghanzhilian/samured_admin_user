define(["app","directive/jrDatepicker","directive/jrDropdownButton","directive/jrPlaceholder","directive/jrPagination"],function(app){app.registerController("CtrlRepayingListV4",function($scope,$http,$state,$stateParams,$filter,$modal){function getData(params){$http.get("/manage/repayingList-v4/json/get/getQingtuiPage",{params:$.extend({},params,{optDesc:"获取清退对账页面"})}).success(function(data){$scope.orders=data.object,$scope.resCode=data.resCode})}$scope.queryParams=$.extend({pageNum:1,pageSize:10},$stateParams),$scope.queryOptions={orderStatus:[{name:"结算状态",value:""},{name:"清退未结清",value:"6000"},{name:"清退已结清",value:"6100"}]},$scope.orders={pageNum:1,pageSize:10},getData($scope.queryParams),$scope.search=function(){$scope.queryParams.pageNum=1,getData($scope.queryParams)},$scope.clearParams=function(){var pageSize=$scope.queryParams.pageSize;$scope.queryParams={pageNum:1,pageSize:pageSize}},$scope.repayConfirm=function(event,order){if(confirm("你确认要对租客“"+order.userName+"”执行确认清退操作吗？")){var params={orderId:order.orderId,optDesc:"确认清退"};$http.get("/manage/repayingList-v4/json/update/confirmQingTui",{params:params}).success(function(res){1==res.success&&getData($scope.queryParams)})}},$scope.addRemark=function(order){var addModal=$modal.open({template:'<div class="modal-header">\r\n    <a href="javascript:void(0)" ng-click="$dismiss(\'cancel\')" class="modal-close"></a>\r\n    <h3 class="modal-title">设置备注</h3>\r\n</div>\r\n<form name="addAgentCompanyForm" novalidate  class="modify-agent-info" autocomplete="off">\r\n    <div class="modal-body">\r\n        <div class="modal-group modal-group-last modal-textarea-wrap">\r\n            <label>备注：</label>\r\n            <div class="group-item textarea-wrap">\r\n                <textarea ng-model="message.remark" ></textarea>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    <div class="modal-footer">\r\n        <p class="error-info">{{errorInfo}}</p>\r\n        <button class="btn btn-primary btn-submit" ng-click="submit()" type="submit">确定</button>\r\n        <button class="btn btn-primary btn-cancel" ng-click="$dismiss(\'cancel\')" >取消</button>\r\n    </div>\r\n</form>',controller:"AddCtrl",resolve:{message:function(){return angular.copy(order)}}});addModal.result.then(function(){getData($scope.queryParams)})},app.registerController("AddCtrl",["$scope","$modalInstance","message",function($scope,$modalInstance,message){$scope.message=message,$scope.message.remark=$scope.message.qingtuiRemark,$scope.submit=function(){var params={orderId:$scope.message.orderId,remark:$scope.message.remark};$http.get("/manage/repayingList-v4/json/add/qingtuiRemark",{params:$.extend({optDesc:"添加清退备注"},params)}).success(function(data){data.success&&$modalInstance.close()})}}]),$scope.$watch("orders.pageNum",function(newValue,oldValue){return newValue===oldValue?!1:($scope.queryParams.pageNum=newValue,void getData($scope.queryParams))}),$scope.$watch("orders.pageSize",function(newValue,oldValue){return newValue===oldValue?!1:($scope.queryParams.pageSize=newValue,void getData($scope.queryParams))}),$scope.export=function(){var params=$.extend({},$scope.queryParams,{optDesc:"导出清退对账"});window.open("/manage/repayingList-v4/json/export/exportRepayingList/repayMoneyList_"+(new Date).getTime()+".xls?"+$.param(params))}})});