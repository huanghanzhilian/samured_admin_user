define(["app"],function(app){app.registerDirective("uiTextarea",[function(){return{restrict:"E",replace:!0,transclude:!0,template:'<span class="ui-textarea"><textarea placeholder="{{placeholder}}" ng-model="value"></textarea><span ng-if="maxlength" class="max-length">{{curlength||0}}/{{maxlength}}</span></span>',scope:{name:"@",placeholder:"@",maxlength:"@",value:"="},link:function($scope,iElement,iAttrs){var $input=iElement.find("textarea");if(iAttrs.readonly)return void $input.attr("readonly",iAttrs.readonly);if($scope.maxlength){var fixLength=function(ele){var value=$(ele).val(),len=value.length;len>$scope.maxlength&&($(ele).val(value.substr(0,$scope.maxlength)),len=$scope.maxlength),$scope.$apply(function(){$scope.curlength=len})};setTimeout(function(){fixLength($input)},250),$input.on("focus",function(){}).on("blur",function(){fixLength(this)}).on("keyup",function(){fixLength(this)})}}}}])});