define(["app","directive/jrDatepicker","directive/jrDropdownButton","directive/jrPlaceholder","directive/jrPagination"],function(app){app.registerController("loanList",function($scope,$http,$state,$stateParams,$filter,$modal){function getData(params){$http.get("/manage/repayingList-v4/json/get/getSendLoanMoneyPage",{params:$.extend({},params,{optDesc:"放款列表"})}).success(function(data){$scope.orders=data.object})}$scope.queryParams=$.extend({pageNum:1,pageSize:10,payStatus:"10"},$stateParams),$scope.queryOptions={payStatus:[{name:"未打款",value:"10"},{name:"已打款",value:"1"}]},$scope.orders={pageNum:1,pageSize:10},getData($scope.queryParams),$scope.search=function(){$scope.queryParams.pageNum=1,getData($scope.queryParams)},$scope.clearParams=function(){var pageSize=$scope.queryParams.pageSize;$scope.queryParams={pageNum:1,pageSize:pageSize}},$scope.repayConfirm=function(event,order){var addModal=$modal.open({template:'\r\n<div class="modal-header">\r\n    <a href="javascript:void(0)" ng-click="$dismiss(\'cancel\')" class="modal-close"></a>\r\n    <h3 class="modal-title">您确定要打款么？</h3>\r\n</div>\r\n<form name="addAgentCompanyForm" novalidate  class="modify-agent-info" autocomplete="off">\r\n    <div class="modal-body">\r\n        <div class="modal-group">\r\n            <label>公寓：</label>\r\n            <div class="list-filter-col">\r\n                {{order.companyName}}\r\n            </div>\r\n\r\n        </div>\r\n        <div class="modal-group">\r\n            <label>账户名称：</label>\r\n            <div class="list-filter-col">\r\n                {{order.ownerName}}\r\n            </div>\r\n        </div>\r\n        <div class="modal-group ">\r\n            <label>银行卡号：</label>\r\n            <div class="list-filter-col">\r\n                {{order.accountText}}\r\n            </div>\r\n        </div>\r\n        <div class="modal-group ">\r\n            <label>银行名称：</label>\r\n            <div class="list-filter-col">\r\n                {{order.bankName}}\r\n            </div>\r\n        </div>\r\n        <div class="modal-group ">\r\n            <label>支行名称：</label>\r\n            <div class="list-filter-col">\r\n                {{order.branchBankName}}\r\n            </div>\r\n        </div>\r\n        <div class="modal-group ">\r\n            <label>金额：</label>\r\n            <div class="list-filter-col">\r\n                {{order.payAmount}}\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="modal-footer">\r\n        <button class="btn btn-primary btn-submit" ng-click="submit()" type="submit">确定</button>\r\n        <button class="btn btn-primary btn-cancel" ng-click="$dismiss(\'cancel\')" >取消</button>\r\n    </div>\r\n</form>',controller:"AddCtrl",resolve:{order:function(){return angular.copy(order)}}});addModal.result.then(function(){getData($scope.queryParams)})},app.registerController("AddCtrl",["$scope","$modalInstance","order",function($scope,$modalInstance,order){$scope.order=order,$scope.errorInfo="",$scope.submit=function(){var params={payCheckId:order.payCheckId,optDesc:"确认打款"};$http.get("/manage/repayingList-v4/json/operate/sendLoanMoney",{params:params}).success(function(res){$.modalAlert(res.message),$modalInstance.close()})}}]),$scope.$watch("orders.pageNum",function(newValue,oldValue){return newValue===oldValue?!1:($scope.queryParams.pageNum=newValue,void getData($scope.queryParams))}),$scope.$watch("orders.pageSize",function(newValue,oldValue){return newValue===oldValue?!1:($scope.queryParams.pageSize=newValue,void getData($scope.queryParams))}),$scope.allchecked=!1,$scope.acheck=function(order,checked){order.checked=checked;var allchecked=!0;$($scope.orders.infoList).each(function(i,item){item.checked||(allchecked=!1)}),$scope.allchecked=allchecked},$scope.change=function(allchecked){$scope.allchecked=allchecked,$($scope.orders.infoList).each(function(i,item){item.checked=$scope.allchecked})},$scope.publishall=function(){var arrId=[];$($scope.orders.infoList).each(function(i,item){item.checked&&arrId.push(item.payCheckId)}),0==arrId.length?$.modalAlert("您还没有选择！"):confirm("确认打款及导出？")&&$http.get("/manage/repayingList-v4/json/operate/confirmPayMoney",{params:{payCheckIdStr:arrId.join(",")}}).success(function(res){res.object&&$.modalConfirm(res.message,function(){window.open("/manage/repayingList-v4/json/export/exportConfirmPayMoney/loanList_"+(new Date).getTime()+".xls?payCheckIdStr="+res.object),getData($scope.queryParams)})})},$scope.exportall=function(){var arrId=[];$($scope.orders.infoList).each(function(i,item){item.checked&&arrId.push(item.payCheckId)}),0==arrId.length?$.modalAlert("您还没有选择！"):$.modalConfirm("你确认要导出吗？",function(){window.open("/manage/repayingList-v4/json/export/exportConfirmPayMoney/loanList_"+(new Date).getTime()+".xls?payCheckIdStr="+arrId.join(","))})}})});