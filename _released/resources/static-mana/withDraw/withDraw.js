define(["app","directive/jrDatepicker","directive/jrDropdownButton","directive/jrPlaceholder","directive/jrPagination"],function(app){app.registerController("withDraw",function($scope,$http,$state,$stateParams,$filter,$modal){function getData(params){$http.get("/manage/repayingList-v4/json/get/getWithDrawPage",{params:$.extend({},params,{optDesc:"放款列表"})}).success(function(data){$scope.orders=data.object})}$scope.queryParams=$.extend({pageNum:1,pageSize:10,withDrawStatus:"0"},$stateParams),$scope.queryOptions={withDrawStatus:[{name:"待审核",value:"0"},{name:"审核成功",value:"1"},{name:"审核失败",value:"-1"}]},$scope.orders={pageNum:1,pageSize:10},getData($scope.queryParams),$scope.search=function(){$scope.queryParams.pageNum=1,getData($scope.queryParams)},$scope.clearParams=function(){var pageSize=$scope.queryParams.pageSize;$scope.queryParams={pageNum:1,pageSize:pageSize}},$scope.repayConfirm=function(event,order){var addModal=$modal.open({template:'\r\n<div class="modal-header">\r\n    <a href="javascript:void(0)" ng-click="$dismiss(\'cancel\')" class="modal-close"></a>\r\n    <h3 class="modal-title">您确定要打款么？</h3>\r\n</div>\r\n<form name="addAgentCompanyForm" novalidate  class="modify-agent-info" autocomplete="off">\r\n    <div class="modal-body">\r\n        <div class="modal-group">\r\n            <label>公寓：</label>\r\n            <div class="list-filter-col">\r\n                {{order.briefName}}\r\n            </div>\r\n\r\n        </div>\r\n        <div class="modal-group">\r\n            <label>账户名称：</label>\r\n            <div class="list-filter-col">\r\n                {{order.ownerName}}\r\n            </div>\r\n        </div>\r\n        <div class="modal-group ">\r\n            <label>银行卡号：</label>\r\n            <div class="list-filter-col">\r\n                {{order.accountText}}\r\n            </div>\r\n        </div>\r\n        <div class="modal-group ">\r\n            <label>银行名称：</label>\r\n            <div class="list-filter-col">\r\n                {{order.bankName}}\r\n            </div>\r\n        </div>\r\n        <div class="modal-group ">\r\n            <label>支行名称：</label>\r\n            <div class="list-filter-col">\r\n                {{order.branchBankName}}\r\n            </div>\r\n        </div>\r\n        <div class="modal-group ">\r\n            <label>金额：</label>\r\n            <div class="list-filter-col">\r\n                {{order.money}}元\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="modal-footer">\r\n        <button class="btn btn-primary btn-submit" ng-click="submit()" type="submit">确定</button>\r\n        <button class="btn btn-primary btn-cancel" ng-click="$dismiss(\'cancel\')" >取消</button>\r\n    </div>\r\n</form>',controller:"AddCtrl",resolve:{order:function(){return angular.copy(order)}}});addModal.result.then(function(){getData($scope.queryParams)})},app.registerController("AddCtrl",["$scope","$modalInstance","order",function($scope,$modalInstance,order){$scope.order=order,$scope.errorInfo="",$scope.submit=function(){var params={detailId:order.detailId,checkResult:"1",optDesc:"确认打款"};$http.get("/manage/repayingList-v4/json/get/checkWithDraw",{params:params}).success(function(res){$.modalAlert(res.message),$modalInstance.close()})}}]),$scope.refuse=function(event,order){var addModal=$modal.open({template:'\r\n<div class="modal-header">\r\n    <a href="javascript:void(0)" ng-click="$dismiss(\'cancel\')" class="modal-close"></a>\r\n    <h3 class="modal-title">您确定要拒绝？</h3>\r\n</div>\r\n<form name="addAgentCompanyForm" novalidate  class="modify-agent-info" autocomplete="off">\r\n    <div class="modal-body">\r\n\r\n        <div class="modal-group ">\r\n            <label>理由：</label>\r\n            <div class="list-filter-col">\r\n                <textarea  class="form-control" placeholder="请输入" style="width: 150px;" ng-model="order.memo"></textarea>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="modal-footer">\r\n        <button class="btn btn-primary btn-submit" ng-click="submit()" type="submit">确定</button>\r\n        <button class="btn btn-primary btn-cancel" ng-click="$dismiss(\'cancel\')" >取消</button>\r\n    </div>\r\n</form>',controller:"refuseCtrl",resolve:{order:function(){return angular.copy(order)}}});addModal.result.then(function(){getData($scope.queryParams)})},app.registerController("refuseCtrl",["$scope","$modalInstance","order",function($scope,$modalInstance,order){$scope.order=order,$scope.order.memo="",$scope.errorInfo="",$scope.submit=function(){if($scope.order.memo){var params={detailId:order.detailId,checkResult:"0",memo:$scope.order.memo,optDesc:"拒绝打款"};$http.get("/manage/repayingList-v4/json/get/checkWithDraw",{params:params}).success(function(res){$.modalAlert(res.message),$modalInstance.close()})}else $.modalAlert("拒绝理由不能为空")}}]),$scope.$watch("orders.pageNum",function(newValue,oldValue){return newValue===oldValue?!1:($scope.queryParams.pageNum=newValue,void getData($scope.queryParams))}),$scope.$watch("orders.pageSize",function(newValue,oldValue){return newValue===oldValue?!1:($scope.queryParams.pageSize=newValue,void getData($scope.queryParams))}),$scope.export=function(){var params=$.extend({},$scope.queryParams,{optDesc:"导出清退对账"});window.open("/manage/repayingList-v4/json/export/exportRepayingList/repayMoneyList_"+(new Date).getTime()+".xls?"+$.param(params))}})});