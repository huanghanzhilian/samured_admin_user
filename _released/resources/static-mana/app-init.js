define(["app","routeDefs","app-http-interceptor","./CtrlApp"],function(app){app.config(["routeDefsProvider","$httpProvider",function(routeDefsProvider,$httpProvider){$httpProvider.defaults.headers.get=$httpProvider.defaults.headers.get||{},$httpProvider.defaults.headers.get["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"}}]),$.modalAlert=function(message,callback){$(".http-modal, .http-modal-backdrop").off().remove();var $modal=$('<div tabindex="-1" class="http-modal modal fade ngAlert in" ng-class="{in: animate}" style="z-index: 1050; display: block;"><div class="modal-dialog"><div class="modal-content"><div class="modal-header">\r\n    <a href="javascript:void(0)" class="modal-close"></a>\r\n    <h3 class="modal-title">提示信息</h3>\r\n</div>\r\n<div class="modal-body">'+message+'</div>\r\n<div class="modal-footer">\r\n    <button class="btn btn-primary">确定</button>\r\n</div></div></div></div>'),$backdrop=$('<div class="modal-backdrop http-modal-backdrop in" style="z-index: 1040;"></div>');$modal.appendTo($("body")),$backdrop.appendTo($("body")),$modal.fadeIn(500),$modal.on("click",".modal-close, .btn-primary",function(){$modal.off().remove(),$backdrop.remove(),callback&&callback()})},$.modalConfirm=function(message,callback){$(".http-modal, .http-modal-backdrop").off().remove();var $modal=$('<div tabindex="-1" class="http-modal modal fade ngAlert in" ng-class="{in: animate}" style="z-index: 1050; display: block;"><div class="modal-dialog"><div class="modal-content"><div class="modal-header">\r\n    <a href="javascript:void(0)" class="modal-close"></a>\r\n    <h3 class="modal-title">确认信息</h3>\r\n</div>\r\n<div class="modal-body">'+message+'</div>\r\n<div class="modal-footer">\r\n    <button class="btn btn-primary">确定</button>\r\n<button class="btn btn-cancel">取消</button>\r\n</div></div></div></div>'),$backdrop=$('<div class="modal-backdrop http-modal-backdrop in" style="z-index: 1040;"></div>');$modal.appendTo($("body")),$backdrop.appendTo($("body")),$modal.fadeIn(500),$modal.on("click",".modal-close, .btn-cancel",function(){$modal.off().remove(),$backdrop.remove()}),$modal.on("click",".btn-primary",function(){$modal.off().remove(),$backdrop.remove(),callback&&callback()})},app.run(["$couchPotato","$state","$stateParams","$rootScope","$http","$modal",function($couchPotato,$state,$stateParams,$rootScope,$http,$modal){app.lazy=$couchPotato,$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.userAuth="",$rootScope.curTime=Date.parse(new Date),$rootScope.endTime=Date.parse(new Date),$rootScope.startTime=Date.parse(new Date)-6048e5,$rootScope.canAccess=function(value){var arr=$rootScope.userAuth.match(/,-.+?(?=,)/g);if(arr)for(var i=0;i<arr.length;i++){var str=arr[i].substr(2,arr[i].length-2);if(value.indexOf(str)>-1)return!1}return $rootScope.userAuth.match(value)||$rootScope.userAuth.match("all")||!$rootScope.userAuth?!0:!1},$.ajax({url:"/manage/public/json/get/userattribute",async:!1,cache:!1,dataType:"json",success:function(data){$rootScope.userInfo=data.object,angular.element("#side").css("visibility","visible"),$rootScope.userAuth=","+data.object.authority+",",$rootScope.rights=data.object.rights,$rootScope.enterpriseId=data.object.enterpriseId,$rootScope.enterpriseStatus=data.object.enterpriseStatus,$rootScope.corInfoDisabled=!1,$rootScope.checkEnterpriseReason=data.object.checkEnterpriseReason,",corporate-info,"==$rootScope.userAuth&&(location.href="#/corporateInfo/main"),$("#top-logo").show(),$("#side-style").remove(),data.object.alertChangePwd&&alert("您的密码是初始密码，为了账户安全，请尽快修改密码！")}}),$rootScope.modifyPassword=function(){$modal.open({template:'<div class="modal-header">\r\n    <a href="javascript:void(0)" ng-click="$dismiss(\'cancel\')" class="modal-close"></a>\r\n    <h3 class="modal-title">修改密码</h3>\r\n</div>\r\n<form class="form-inline modify-agent-info" autocomplete="off" name="modifyPasswordForm">\r\n    <div class="modal-body">\r\n        <div class="form-group">\r\n            <label for="old-password">旧密码</label>\r\n            <input type="password" autocomplete="off" required ng-model="modify.password" class="form-control" id="old-password" >\r\n        </div>\r\n        <div class="form-group">\r\n            <label for="new-password">新密码</label>\r\n            <input type="password" required ng-model="modify.newPassword" class="form-control" id="new-password" >\r\n        </div>\r\n        <div class="form-group">\r\n            <label for="new-password-confirm">确认新密码</label>\r\n            <input type="password" required ng-model="modify.newPasswordConfirm" class="form-control" id="new-password-confirm" >\r\n        </div>\r\n    </div>\r\n    <div class="modal-footer">\r\n        <span class="error-info">{{errorInfo}}</span>\r\n        <button class="btn btn-primary btn-submit"  ng-click="modifySubmit($event)" ng-disabled="modifyPasswordForm.$invalid" type="submit">确定</button>\r\n        <button class="btn btn-cancel" ng-click="$dismiss(\'cancel\')">取消</button>\r\n    </div>\r\n</form>',controller:"ModalModifyPassword",backdrop:"static"})},app.registerController("ModalModifyPassword",function($scope,$modalInstance){$scope.modify={},$scope.modifySubmit=function(){return $scope.modify.newPassword!==$scope.modify.newPasswordConfirm?($scope.errorInfo="新密码和确认新密码输入不一致",!1):void $http.post("/manage/public/json/update/updatePassword",$.param({password:$.fn.md5($scope.modify.password),newPassword:$.fn.md5($scope.modify.newPassword),optDesc:"修改密码"})).success(function(){$modalInstance.close()})}}),app.registerFilter("encodeURI",function(){return function(value){return encodeURIComponent(value)}})}])});